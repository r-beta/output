# ドメイン駆動設計 モデリング/実装ガイド
## 第1章 DDD概要
- **ドメイン = ソフトウェアで問題解決しようとする対象領域**
- **DDD = モデリングによってソフトウェアの価値を高めること**
    - その手段としてアーキテクチャ等でコード品質を上げる話がある
- DDDで頻出かつ混乱を招きやすいモデル
    - ドメインモデル: ドメインの問題を解決するモデル
    - データモデル: データの永続化方法を決めるためのモデル
- 良いモデルは問題を解決できるモデル
- 良いモデルを作るには
    - ドメインエキスパートと会話する
    - 運用して得られた発見をモデルに還元する
- 極力モデルとコードの表現を近づけることを目指す
- 軽量DDD = 頻繁な変更に耐えうる拡張性の高い設計のベストプラクティス(VOやエンティティやリポジトリなど)だけを取り入れること
    - 軽量DDDは良くないという話題も目にするが、まず設計を改善してモデル改善するということもあるので、一概に良くないとは言えない。
- DDDに取り組む上で重要な考え
    - 課題ドリブンであること
        - 目的が不明瞭でユビキタス言語を取り入れたけど、そのままメンテナンスされない、なんてのはよくある話(あれ、どっかで聞いたことあるぞw)
    - 小さく始めて小さく失敗する
- DDDが向いているのはドメインが複雑な場合


## 第2章 モデリングから実践まで
- 小さく始められて効果が出やすいパターン: ユースケース図→ドメインモデル図作成
- 議論を始めるときは最初に全部のドメインモデル図を作成しようとせず、スコープを絞る
- ドメインモデル図とは
    - 簡易的なクラス図みたいなもの
    - 以下特徴
        - オブジェクトの代表的な属性を書くがメソッドは不要
        - 「ルール/成約(ドメイン知識)」を吹き出しに書き出す
        - オブジェクト同士の関連を示す
        - 多重度を定義
        - 集約の範囲を定義
        - 理解促進のための具体例があるとbetter
- ドメインモデルの実装
    - ドメインモデル貧血症とはドメイン知識をほぼ持たないオブジェクト
        - 問題点1: 不整合なデータをいくらでも作れる
        - 問題点2: 仕様を追いかけるのに多くのクラスをコード参照から追う必要がある
    - ユースケースはHowは隠蔽され、Whatだけが示されるようになる
- ドメイン層オブジェクト設計の基本方針
    1. ドメイン知識を対応するオブジェクトに書く
    1. 常に正しいインスタンスをしか存在させない
        - 生成条件の強制
        - ミューテーション条件の強制
- 上記のような開発をすすめるにはテストコードの存在が重要になる

## 第3章　DDD固有のモデリング方法
- 集約: 必ず守りたい強い整合性を持ったオブジェクトのまとまり
    - 強い整合性確保が必要なものを1つの集約にする
    - トランザクションを必ず1つにする
- ただし、集約の境界は機械的な決め方出来ず、バランスを踏まえ得て判断が必要。主に以下の2つの観点
    - 整合性を確保する必要性の強さ
    - トランザクションの範囲の適切さ
- 集約の範囲が大きいと不必要に大きなロックを取り、問題が発生する
- システムが大規模になると関係者全てで統一したモデルを作ることは難しくなる
- モデルが適用される範囲を明示的に定義し、それぞれの中でモデル、言語の統一を目指す
    この明示的に定義された範囲を「境界づけられたコンテキスト」と呼ぶ
- tips
    - ドメインモデル図を考えるときにどうしてもRDBのDB構成を意識してしまう場合、NoSQLのデータストアと想定して考えるといい。
    - ドメインモデル図を考える際なるべく技術的な観点を切り離したほうが良いが、集約を考えるときはトランザクションの観点が必要なため、集約に関してはモデリング時に決めきろうとせずに実装してからモデルに戻って試行錯誤するくらいのスタンスで望むと良い

## 第4章 設計の基本原則
