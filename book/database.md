# 達人に学ぶDB設計徹底指南書
## 第1章 データベースを制するものはシステムを制す
- データ中心アプローチ(DOA)とプロセス中心アプローチ(POA)があり、POAは時代遅れになっている。
- 3層スキーマモデル
    - 外部スキーマ: ビューの世界
    - 概念スキーマ: テーブルの世界
    - 内部スキーマ: ファイルの世界

## 第2章 論理設計と物理設計
- 論理設計→物理設計の順
### 2-1　概念スキーマと論理設計
- 論理設計のステップ
    1. エンティティの抽出
    1. エンティティの定義
    1. 正規化
    1. ER図の作成

### 2-2.内部スキーマと物理設計
- 物理設計のステップ
    1. テーブル定義
    1. インデックス定義
    1. ハードウェアのサイジング
    1. ストレージの冗長構成
    1. ファイルの物理配置決定
- サイジングはキャパシティとパフォーマンスの2つの観点から行う。
- データベースの性能問題の8割はディスクI/Oによって起こる。DB
- データの整合性とパフォーマンスは強いトレードオフがある。
- サイジングをするにあたり、以下の入力情報が必要
    - キャパシティのサイジング
        - システムで利用するデータ量
        - サービス終了時のデータ増加率
    - パフォーマンスのサイジング
        - 性能要件
            - 処理時間(何秒以内時終了するか)
            - スループット(単位時間あたりにどれだけの処理をこなせるか)
        - リソース使用量の基礎数値->これは机上では見えにくいので、以下の方法で得る
            - 類似システムから推測する
            - プロトタイプシステムを構築して性能検証する
- **精度の高いサイジングは難しいので以下の2点を心がけることが大事**
    - 必ず実施時に安全率をかける
    - スケーラビリティの高い構成を組むこと


### 2-4.リカバリ設計
- リストアとリカバリの違
    - リストア: バックアップファイルを戻す作業
    - リカバリ: そのバックアップファイルに対してトランザクションログを適用して変更分を反映すること
- 重要なのはリカバリの方
- DB障害発生復旧の手順
    1. フルバックアップのファイルをデータベースに戻す(リストア)
    1. 差分(または増分)バックアップしていたトランザクションログを適用する。(リカバリ)
    1. データベースサーバーに残っているトランザクションログを適用する。(ロールフォワード)
- DBサーバーのクラスタリング構成
    - スタンドアロン(冗長性がないのでまず採用されない)
    - ActiveStandby方式(サーバー2台で片方が予備)→性能はスタンドアロンと変わらない
        - ホットスタンバイ(復旧早いけど、光熱費とかライセンス日が余分にかかる恐れ)
        - コールドスタンバイ(復旧遅いけど、安い)
    - ActiveActive方式(複数サーバーを現用系で稼働)
        - シェアードディスク(ディスクを共有、他リソースは別)→ディスクを共有しているので性能頭打ち似鳴子tが多い
        - シェアードナッシング(全リソース別)

## 第3章 論理設計と正規化～なぜテーブルは分割する必要があるのか?
### 3-1.テーブルとは何か？
- テーブル名は英語ならば複数形／複数名詞で書ける。そうでなければそのテーブルにはどこか間違いがある。
### 3-2.テーブルの構成要素
- (個人的反省)キーとカラムをごっちゃに話してしまった事があるんので気をつける
- 外部キーが設定されている場合、データの削除は子から順に操作するのが吉。
- テーブル定義において、列には可能な限りNOTNULL制約を付加する。

### 3-3.正規化とは何か？
- 正規形のレベルは第5まであるが、普通は第3正規形まで理解すれば十分。
- 正規化は可逆的な処理 ※ボイスコッド正規化を除く

### 3-4.第1正規形
- 第1正規形の定義とは「一つのセルの中には一つの値しか含まない」

### 3-5.第2正規形~部分関数従属
- 言葉の定義
    - 関数従属性: ある属性Xを決めると、他の属性Yの値が一意に決まる場合、「YはXに関数従属している」といいX→Yと表現する
    - 完全関数従属: 主キーの全ての値を用いて、値が決まる
    - 部分関数従属: 主キーの一部の項目によって値が決定する
- 第2正規形は、部分関数従属を解消することで得られる。

### 3-6.第3正規形~推移的関数従属
- 推移的関数従属: 主キー以外の項目について項目同士で依存関係を持っていること
- 第3正規形は、推移的関数従属を解消することで得られる。

### 3-7. ボイスコッド正規形
- ボイスコッド正規形とは、すべての列が主キーに完全関数従属で、他に完全関数従属関係がないもの
- つまり、第3正規形から更に**非キーからキーへの関数従属をなくした状態**
- ただし、ボイスコッド正規化は非可逆的である点に注意

### 3-8. 第4正規形
- 言葉の定義
    - 関連エンティティ: エンティティ同士の関連を表現するエンティティ(中間テーブルのこと？)
    - 多値従属性: 多値従属性とは、Aが決まるとBの集合が決まるという関係のことであり、A→→Bと表記する。e.g. 地方→都道府県。関数従属性は属性で、多値従属性は集合について。
- 関連エンティティに含まれる関連は一つだけにすること。複数の関連を詰め込まない。
- ぼやき: 第3正規化まで知っておけば十分と言われるけど、第4正規化までやっておく必要あるよな。。。普通こんなテーブル設計しないだろうけど
- 第4正規形: 

### 3-9. 第5正規形
- 第4正規形のような関連エンティが3組以上あるときにしっかり分ける。
<!-- ToDo: 理解していなくても問題なく実施できそうなものだが、若干理解が曖昧 -->

### 3-10. 正規化についてのまとめ
- ポイント
    - 正規形とは更新時の不都合/不整合を排除するために行う
    - 正規化は従属性を見抜くことで可能になる
    - 正規形はいつでも非正規系に戻せる
- メリット
    - データの冗長性が排除され、更新時の不整合を防止できる
    - テーブルの保つ意味が明確になり、開発者が理解しやすい
- デメリット
    - テーブルの数が増えるので、SQLで結合を多用することになりパフォーマンスが悪化する

